<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Session '{{sessionId}}'</title>
	<script src="/static/js/d3/d3.v3.min.js"></script>
	<script src="/static/js/d3/dagre-d3.min.js"></script>
	<script src="/static/js/dom.js"></script>
	<link  href="/static/css/session.css"rel="stylesheet" type="text/css"/>
	<link rel="icon" href="data:;base64,iVBORw0KGgo=">
</head>

<body>
<div>
	<span>Session status: <span id="session-status"></span></span>
</div>
<div class="live map">
	<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g/></svg>
</div>

<script>

  // Set up zoom support
  var svg = d3.select("svg")
  var inner = svg.select("g")
  var zoom = d3.behavior.zoom().on("zoom", function() {
        inner.attr("transform", "translate(" + d3.event.translate + ")" +
                                    "scale(" + d3.event.scale + ")");
      });
  svg.call(zoom);

  var render = new dagreD3.render();
  var g = new dagreD3.graphlib.Graph();
  g.setGraph({
    nodesep: 70,
    ranksep: 50,
    rankdir: "LR", // Left-to-right layout
    marginx: 20,
    marginy: 20
  });

  function draw() {
    inner.call(render, g);

    // Zoom and scale to fit
    var graphWidth = g.graph().width + 80;
    var graphHeight = g.graph().height + 40;
    var width = parseInt(svg.style("width").replace(/px/, ""));
    var height = parseInt(svg.style("height").replace(/px/, ""));
    var zoomScale = Math.min(width / graphWidth, height / graphHeight);
    var translate = [(width/2) - ((graphWidth*zoomScale)/2), (height/2) - ((graphHeight*zoomScale)/2)];
    zoom.translate(translate);
    zoom.scale(zoomScale);
  }

  startStatusQuery(g, '{{!serverUrl}}', '{{sessionId}}', 1000)

</script>
</body>
</html>