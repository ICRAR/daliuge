<!doctype html>

<head>
	<meta charset="utf-8">
	<title>{{dmType}} {{dmId}}</title>
	<script src="/static/js/d3/d3.v3.min.js"></script>
	<script src="/static/js/dm.js"></script>
	<script src="/static/js/jquery-1.11.3.min.js"></script>
	<script src="/static/js/bootstrap.min.js"></script>
	<script src="/static/js/bootbox.min.js"></script>
	<link rel="icon" href="data:;base64,iVBORw0KGgo=">
	<link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
</head>

<body>
<div class="container">
<h1>{{dmType}} {{dmId}}</h1>

<h2>Sessions</h2>
	<table id="sessionsTable" class="table table-striped">
		<thead>
			<tr>
				<th>Session ID</th>
				<th>State</th>
				<th>Details</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
<button id="addSessionBtn"  type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus"></span> Add Session</button>
<button id="refreshListBtn" type="button" class="btn btn-default"><span class="glyphicon glyphicon-refresh"></span> Refresh</button>

<h2>Nodes</h2>
	<table id="nodesTable" class="table table-striped">
		<thead>
			<tr>
				<th>Node</th>
				<th>Details</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
</div>

<script type="text/javascript">

var serverUrl = '{{serverUrl}}';
var nodes = {{!hosts}}
var dmPort = {{dmPort}}
var refreshBtn = d3.select('#refreshListBtn');
var addSessionBtn = d3.select('#addSessionBtn');
var tbodyEl = d3.select('#sessionsTable tbody')

nodes.sort()
rows = d3.select('#nodesTable tbody').selectAll('tr').data(nodes)
newRow = rows.enter().append('tr')
newRow.style('opacity', 0.0).transition().delay(0).duration(500).style('opacity',1.0);
newRow.append('td').classed('id', true).text(String)
newRow.append('td').classed('details', true)
      .append('a').attr('href', function(n) { return 'http://' + n + ':' + dmPort + '/'; })
      .append('span').classed('glyphicon glyphicon-share-alt', true)

// Listeners for the two buttons
addSessionBtn.on('click', function(){ promptNewSession(serverUrl, tbodyEl, refreshBtn); } );
refreshBtn.on('click', function(){ loadSessions(serverUrl, tbodyEl, refreshBtn, false); } );

//Start loading the list of sessions periodically
d3.timer(function(){
	loadSessions(serverUrl, tbodyEl, refreshBtn, true, 5000);
	return true;
});

</script>
</body>